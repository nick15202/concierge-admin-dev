!function r(a,s,l){function d(i,e){if(!s[i]){if(!a[i]){var t="function"==typeof require&&require;if(!e&&t)return t(i,!0);if(c)return c(i,!0);var n=new Error("Cannot find module '"+i+"'");throw n.code="MODULE_NOT_FOUND",n}var o=s[i]={exports:{}};a[i][0].call(o.exports,function(e){return d(a[i][1][e]||e)},o,o.exports,r,a,s,l)}return s[i].exports}for(var c="function"==typeof require&&require,e=0;e<l.length;e++)d(l[e]);return d}({1:[function(e,i,t){"use strict";angular.module("ngFormioGrid",["formio","ngSanitize","ui.grid","ui.grid.pagination","ui.grid.resizeColumns","ui.grid.autoResize","ui.grid.selection","ui.grid.edit","ui.grid.cellNav"]).directive("formioGridCell",["$compile","formioTableView",function(e,o){return{restrict:"E",scope:{data:"=",component:"="},link:function(t,n){t.$watch("data",function(e){var i=o(e,t.component);Array.isArray(i)&&(i=i.join(", ")),n.html(i)})}}}]).directive("formioGrid",["$compile",function(o){return{restrict:"E",replace:!0,scope:{src:"=",service:"=?",query:"=?",aggregate:"=?",columns:"=?",buttons:"=?",gridOptions:"=?",gridApi:"=?",limit:"=?"},link:function(e,i,t){var n='<div ui-grid="gridOptionsDef" ui-grid-pagination ui-grid-auto-resize ui-grid-resize-columns ui-grid-move-columns ui-grid-selection class="grid"></div>';e.gridOptions&&e.gridOptions.enableCellEdit&&(n='<div ui-grid="gridOptionsDef" ui-grid-pagination ui-grid-auto-resize ui-grid-resize-columns ui-grid-move-columns ui-grid-edit ui-grid-cellNav class="grid"></div>'),i.html(n).show(),o(i.contents())(e)},template:"<div></div>",controller:["$scope","$element","$timeout","Formio","formioComponents","FormioUtils","uiGridConstants","$http","$q",function(u,t,i,s,e,r,n,l,o){var a=o.defer(),d=a.promise,c=u.service||null,g={pageNumber:1,pageSize:25,sort:null};u.query&&u.query.sort&&(g.sort=u.query.sort);var p={},f=function(){p=u.columns,Array.isArray(u.columns)&&(p={},u.columns.forEach(function(e){"string"==typeof e?p[e]={}:p[e.key]=e}))};f();var m=function(e,i){switch(e.direction){case n.ASC:g.sort=i;break;case n.DESC:g.sort="-"+i;break;case void 0:g.sort=null}},h=function(e){var i=angular.element(".ui-grid-contents-wrapper .ui-grid-loader",t);if(e&&0==i.length){angular.element(".ui-grid-contents-wrapper",t).prepend('<i style="font-size:2em;position:absolute;z-index:200;left: 50%;top:50%;margin-left:-1em;margin-top:-1em;" class="ui-grid-loader glyphicon glyphicon-refresh glyphicon-spin"></i>')}else i.length&&i.remove()};u.gridOptionsDef=angular.extend({namespace:"row",dataRoot:"data.",responseData:"",responseTotal:"",endpoint:"",paginationPageSizes:[25,50,75],paginationPageSize:g.pageSize,enableHorizontalScrollbar:n.scrollbars.NEVER,enableVerticalScrollbar:n.scrollbars.NEVER,useExternalPagination:!0,useExternalSorting:!0,enableCellEdit:!1,enableCellEditOnFocus:!1,enableRowSelection:!0,enableRowHeaderSelection:!1,enableFiltering:!0,useExternalFiltering:!0,multiSelect:!1,loadOptions:null,columnDefs:[],data:[],initialLoad:!0,onRegisterApi:function(n){(u.gridApi=n).pagination.on.paginationChanged(u,function(e,i){g.pageNumber=e,g.pageSize=i,O()}),n.core.on.renderingComplete(u,function(){h(!0),u.gridOptions&&u.gridOptions.sort&&m(u.gridOptions.sort,u.gridOptions.sort.defaultCol)});var i=0;n.core.on.filterChanged(u,function(){var e=this.grid;i&&clearTimeout(i),i=setTimeout(function(){e.columns.forEach(function(e){var i="";e.filters&&0<e.filters.length&&(i=e.filters[0].term);var t=e.colDef.filterField||e.colDef.filter||e.colDef.field;t&&("function"==typeof t?t(u.query,i):"object"==typeof t?"select"===t.type&&("boolean"==typeof i?u.query[e.colDef.field]=i:i?u.query[e.colDef.field]=i:delete u.query[e.colDef.field]):i?u.query[t+"__regex"]="/"+r.escapeRegExCharacters(i)+"/i":delete u.query[t+"__regex"])}),n.pagination.seek(1),O()},500)});n.core.on.rowsRendered(u,function(){0!==n.grid.renderContainers.body.visibleRowCache.length&&(u.$emit("onGridLoadDone"),!1)}),n.selection&&(n.selection.on.rowSelectionChanged(u,function(e){u.$emit(u.gridOptionsDef.namespace+"Select",e.entity,e.isSelected)}),n.selection.on.rowSelectionChangedBatch(u,function(e){var i=!!e.length&&e[0].isSelected;u.$emit(u.gridOptionsDef.namespace+"SelectAll",e,i)})),n.edit&&n.edit.on.afterCellEdit(u,function(e,i,t,n){u.$emit(u.gridOptionsDef.namespace+"CellEdit",e,i,t,n),u.$apply()}),n.core.on.sortChanged(u,function(e,i){if(0===i.length)g.sort=null;else{var t=i.length-1;m(i[t].sort,i[t].colDef.sortField||i[t].colDef.field)}n.pagination.seek(1),O()})}},u.gridOptions),g.pageSize=u.gridOptionsDef.paginationPageSize,u.buttons=u.buttons||[],u.buttonClick=function(e,i){u.$emit(e,i.entity,i)},angular.isUndefined(u.query)&&(u.query={});var O=function(a){d.then(function(){if(u.gridOptions&&u.gridOptions.columnDefs&&(u.gridOptionsDef.columnDefs=u.gridOptions.columnDefs),g.pageSize&&(u.limit?u.query.limit=u.limit:u.query.limit=g.pageSize),g.pageNumber&&(u.query.skip=(g.pageNumber-1)*g.pageSize),g.sort&&(u.query.sort=g.sort),u.gridOptionsDef.endpoint){var e=u.gridOptionsDef.endpoint,i={headers:{"x-jwt-token":s.getToken()}};if(u.aggregate){var t=a||angular.copy(u.aggregate),n={};if(angular.forEach(u.query,function(e,i){if(0===i.indexOf("data."))if(-1!==i.indexOf("__regex")){var t=e.match(/\/([^\/]+)\//);(t=t&&1<t.length?t[1]:"")&&(n[i.replace("__regex","")]={$regex:t,$options:"i"})}else n[i]=e}),0<Object.keys(n).length&&t.push({$match:n}),u.query.sort){var o={$sort:{}};if("-"===u.query.sort.charAt(0)){var r=u.query.sort.slice(1);o.$sort[r]=-1,t.push(o)}else o.$sort[u.query.sort]=1,t.push(o)}u.query.limit&&t.push({$limit:u.query.limit}),u.query.skip&&t.push({$skip:u.query.skip}),i.headers["x-query"]=JSON.stringify(t)}else i.params=a||u.query;u.$emit("onRequest",t||i.params),u.$emit("onRequest:"+u.gridOptionsDef.namespace,t||i.params),l.get(e,i).then(function(e){e.data||(e.data=[]);var i=e.headers("Content-Range");i&&1<(i=i.split("/")).length&&"*"!=i[1]&&(u.gridOptionsDef.totalItems=Number(i[1])),u.gridOptionsDef.responseData?u.gridOptionsDef.data=e.data[u.gridOptionsDef.responseData]:u.gridOptionsDef.data=e.data?e.data:[],u.gridOptionsDef.responseTotal&&(u.gridOptionsDef.totalItems=e.data[u.gridOptionsDef.responseTotal]),y(e.data.length),h(!1),u.$emit("onData",e.data),u.$emit("onData:"+u.gridOptionsDef.namespace,e.data)},function(e){console.log("Error: "+e.message)})}else{if(!c)return void h(!1);u.gridOptionsDef.data=[],u.$emit("onRequest",u.query),u.$emit("onRequest:"+u.gridOptionsDef.namespace,u.query),c.loadSubmissions({params:u.query},u.gridOptionsDef.loadOptions).then(function(e){u.gridOptionsDef.totalItems=e.serverCount,u.gridOptionsDef.data=e,y(e.length),h(!1),u.$emit("onData",e),u.$emit("onData:"+u.gridOptionsDef.namespace,e)})}})},y=function(e){return i(function(){var e=u.gridOptions&&u.gridOptions.height?u.gridOptions.height:30*u.gridApi.grid.getVisibleRowCount()+100;angular.element(".grid",t).height(e)},10),e},D=function(s){f();var l={},d=1;u.gridOptionsDef.columnDefs=u.gridOptions&&u.gridOptions.columnDefs?angular.copy(u.gridOptions.columnDefs):[],u.buttons.forEach(function(e){var i=e.class||"btn btn-sm btn-default";l[e.label]=!0,u.gridOptionsDef.columnDefs.unshift({name:e.label,field:e.key,width:e.width,enableFiltering:!1,cellTemplate:'<a class="'+i+'" ng-click="grid.appScope.buttonClick(\''+e.event+'\', row)"><span class="'+e.icon+'" aria-hidden="true"></span>'+e.label+"</a>"})});var c=0,n=function(e,i,t){i=i||{},0!==c||i.hasOwnProperty("link")||(i.link=!0);var n="";if(i.hasOwnProperty("label"))n=i.label;else if(e)for(n=e.label||e.key;l.hasOwnProperty(n);)n=e.label+d++;l[n]=!0;var o=i.template||'<formio-grid-cell class="ui-grid-cell-contents" data="COL_FIELD" component="col.colDef.component"></formio-grid-cell>';i.link&&(o='<a class="'+i.linkClass+'" style="cursor:pointer;" ng-click="grid.appScope.buttonClick(\''+(i.linkEvent||u.gridOptionsDef.namespace+"View")+"', row)\">"+o+"</a>");var r=i.field;i.field||(r=e?u.gridOptionsDef.dataRoot+e.key:t);var a={component:e,name:n,field:r,cellTemplate:o,form:s,enableCellEdit:!!i.enableCellEdit,enableFiltering:!!i.enableFiltering};["sort","sortField","filterField","filter","width","sortable","visible","minWidth","maxWidth","resizable","cellClass","headerCellClass","headerCellTemplate","displayName"].forEach(function(e){i.hasOwnProperty(e)&&(a[e]=i[e])}),u.gridOptionsDef.columnDefs.push(a),c++};if(p&&0<Object.keys(p).length){var o=s?r.flattenComponents(s.components):{};angular.forEach(p,function(e,i){if(e.sort&&e.sort.direction){var t=o.hasOwnProperty(i)?"data."+i:i;m(e.sort,e.field||t)}n(o[i]||e.component,e,i)})}else s&&r.eachComponent(s.components,function(e){e.input&&e.tableView&&e.key&&n(e)});a.resolve(),u.gridOptionsDef.initialLoad&&O(),u.gridOptionsDef.initialLoad=!0,u.$emit("onGridReady"),u.$emit("onGridReady:"+u.gridOptionsDef.namespace)},b=function(){u.src?(c=new s(u.src)).loadForm().then(D):D()},v=function(i){u.gridOptionsDef.enableRowSelection&&("string"==typeof i?angular.forEach(u.gridOptionsDef.data,function(e){e._id.toString()===i&&u.gridApi.selection.selectRow(e)}):u.gridApi.selection.selectRow(i))},q=function(e){h(!0),e&&(u.query=e),O(e)},$=function(e,i){e&&(u.src=e),i&&(u.query=i),h(!0),b()};u.$on("selectGridRow:"+u.gridOptionsDef.namespace,function(e,i){v(i)}),u.$on("selectGridRow",function(e,i){v(i)}),u.$on("reloadGrid:"+u.gridOptionsDef.namespace,function(e,i,t){$(i,t)}),u.$on("reloadGrid",function(e,i,t){$(i,t)}),u.$on("refreshGrid:"+u.gridOptionsDef.namespace,function(e,i){q(i)}),u.$on("setLoading",function(e,i){h(i)}),u.$on("refreshGrid",function(e,i){q(i)}),u.$on("adjustHeight",function(e,i){y(i)}),b()}]}}])},{}]},{},[1]);